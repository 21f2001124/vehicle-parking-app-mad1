<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/style.css" />
    <style>
        .search-results-title {
            text-align: center;
            color: #007bff;
            font-weight: 500;
            margin-top: 30px;
        }

        .lot-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px auto;
            text-align: center;
            max-width: 250px;
        }

        .spot-grid {
            display: grid;
            grid-template-columns: repeat(5, 30px);
            gap: 5px;
            justify-content: center;
            margin-top: 10px;
        }

        .spot {
            width: 30px;
            height: 30px;
            line-height: 30px;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-size: 14px;
        }

        .occupied {
            background-color: #f8d7da;
            color: #721c24;
        }

        .available {
            background-color: #d4edda;
            color: #155724;
        }
    </style>
</head>

<body>
    <nav class="Adashbox">
        <span style="padding-right: 150px; font-size: larger;"> Welcome to admin</span>
        <a href="{{ url_for('Adashboard') }}">home</a>
        <a href="{{ url_for('AdashUser') }}">user</a>
        <a href="{{ url_for('AdashSearch') }}">search</a>
        <a href="{{ url_for('AdashSummary') }}">summary</a>
        <a href="{{ url_for('logout') }}">logout</a>
        <a style="padding-left: 400px;" href="{{ url_for('Aeditprofile') }}">Edit profile</a>
    </nav>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="container mt-3">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" id="flash-message">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <script>
        // Auto-hide flash message after 4 seconds
        setTimeout(() => {
            const flash = document.getElementById('flash-message');
            if (flash) {
                flash.style.display = 'none';
            }
        }, 2000);
    </script>


    <div class="d-flex justify-content-center mt-3">
        <form action="{{ url_for('AdashSearch') }}" method="get" class="d-flex gap-2 flex-wrap">
            <select name="dropdown" class="form-select w-auto">
                <option value="">Search by</option>
                <option value="user_id" {% if dropdown=='user_id' %}selected{% endif %}>User ID</option>
                <option value="location" {% if dropdown=='location' %}selected{% endif %}>Location</option>
                <option value="pincode" {% if dropdown=='pincode' %}selected{% endif %}>Pin Code</option>
            </select>
            <input type="text" name="query" class="form-control w-auto" placeholder="Enter search string"
                value="{{ query or '' }}">
            <button class="btn btn-success" type="submit">Search</button>
        </form>
    </div>


    {% if search_info %}
    <h5 class="search-results-title">Results for {{ search_info }}</h5>
    {% endif %}

    <div class="container">
        <div class="row justify-content-center">
            {% for lot in lots %}
            <div class="col-md-3">
                <div class="lot-card">
                    <h6>Parking#{{ lot.lot_id }}</h6>
                    <a href="{{ url_for('Aeditparkinglot', lot_id=lot.lot_id) }}" class="text-warning">Edit</a> |
                    <a href="{{ url_for('delete_parking_lot', lot_id=lot.lot_id) }}" class="text-danger">Delete</a>
                    <p class="mt-2 text-success">(Occupied: {{ lot.occupied }}/{{ lot.total }})</p>
                    <div class="spot-grid">
                        {% for spot in lot.spots %}
                        <div class="spot {% if spot.status=='occupied' %}occupied{% else %}available{% endif %}">
                            {% if spot.status=='occupied' %}O{% else %}A{% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {% endfor %}
        </div>
    </div>
</body>

</html>